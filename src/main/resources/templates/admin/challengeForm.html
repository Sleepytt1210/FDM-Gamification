<!DOCTYPE html>
<html lang="en"
      layout:decorate="~{adminLayout.html}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'Challenge ' + ${challenge.id}"></title>
    <link rel="stylesheet" th:href="@{/css/challengeForm.css}" type="text/css">
    <script th:src="@{/javascript/imageUpload.js}"></script>
    <script th:src="@{/javascript/validation.js}"></script>
</head>
<body>
<ul layout:fragment="sidenav">
    <li class="sidebar-menu"><a th:href="@{/admin/challenges}">Challenges</a></li>
    <li class="sidebar-menu"><a th:href="@{/admin/questions}">Questions</a></li>
    <li class="sidebar-menu"><a th:href="@{/admin/choices}">Choices</a></li>
</ul>
<div layout:fragment="content2">
    <form enctype="multipart/form-data" id="challenge-form" method="post"
          th:action="@{/admin/challenges/__${challenge.id}__}" th:object="${challenge}">
        <ul class="errorlist" th:if="${#fields.hasErrors('*')}">
            <li th:each="err : ${#fields.errors('*')}" th:text="${err}">Input is incorrect</li>
        </ul>
        <div class="form-group">
            <label for="title" th:text="${'Title'}"></label>
            <div class="input-div">
                <input class="title-input" id="title" name="challenge-title" th:field="*{challengeTitle}" th:value="*{challengeTitle}"
                       type="text"/>
            </div>
        </div>
        <div class="form-group">
            <label for="description" th:text="${'Description'}"></label>
            <div class="input-div">
                <input id="description" name="challenge-description" th:errorclass="fieldError" th:field="*{description}"
                       th:value="*{description}"
                       type="text" class="description-input"/>
            </div>
        </div>
        <div class="form-group">
            <label for="thumbnail" th:text="${'Thumbnail'}"></label>
            <input accept="image/jpeg, image/png" class="hidden" id="thumbnail" name="pic" type="file">
            <div class="image-display" id="image-upload-wrapper" th:with="completeUrl='data:'+*{thumbnail.fileType}+';base64, '+*{thumbnail.base64String},
                 hasUrl=${!challenge.thumbnail.base64String.isBlank() && !challenge.thumbnail.base64String.isEmpty()}">
                <img id="preview" th:alt="*{thumbnail.fileName}" th:src="${completeUrl}"
                     th:style="${hasUrl ? 'display: block;' : 'display: none;'}">
            </div>
        </div>
        <div class="form-group">
            <label for="stream" th:text="${'Stream'}"></label>
            <div class="input-div">
                <select id="stream" name="stream">
                    <option th:each="stream : ${allStreams}" th:selected="${stream == challenge.stream}" th:label="${(stream.name == 'NONE') ? 'Choose stream...' : stream.fullName}"
                            th:value="${stream}"></option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label>Questions</label>
            <button class="add-button" name="addQuestion" type="submit">ADD</button>
            <table>
                <th:block class="questions" th:each="ques : ${challenge.questions}">
                    <thead>
                    <tr>
                        <th th:text="'Question ID: ' + ${ques.key}">Question</th>
                        <th>Question text</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <input class="title-input" name="question-title" th:field="*{questions[__${ques.key}__].questionTitle}"
                                   type="text"/>
                        </td>
                        <td>
                            <input class="description-input" name="question-text" th:field="*{questions[__${ques.key}__].questionText}"
                                   type="text"/>
                        </td>
                        <td>
                            <button class="remove-button" name="removeQuestion"
                                    th:value="${ques.key}" type="submit">REMOVE
                            </button>
                        </td>
                    </tr>
                    <!-- Choice part -->
                    <th:block class="choices">
                        <tr>
                            <th>
                                Choice Text
                            </th>
                            <th>
                            </th>
                        </tr>
                        <tr th:each="choice : ${ques.value.choices}">
                            </td>
                            <td>
                                <input th:field="*{questions[__${ques.key}__].choices[__${choice.key}__].choiceText}"
                                       type="text">
                            </td>
                            <td>
                                <button class="remove-icon" name="removeChoice"
                                        th:value="${ques.key + ',' + choice.key}" type="submit">&times;
                                </button>
                            </td>
                        </tr>
                        <tr class="add-row">
                            <td>
                                <button class="add-icon" name="addChoice" th:value="${ques.key}" type="submit">+
                                </button>
                            </td>
                        </tr>
                    </th:block>
                    </tbody>
                </th:block>
            </table>
        </div>

        <div class="submit">
            <input name="save" type="submit" value="Save">
        </div>
    </form>
</div>
</body>
</html>